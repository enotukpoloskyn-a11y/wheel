<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–¥–±–æ—Ä –∏ –ø—Ä–∏–º–µ—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—å–Ω—ã—Ö –¥–∏—Å–∫–æ–≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f7fafc;
    }
    .disc-card {
        min-height: 450px;
    }
    .disc-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    /* –°—Ç–∏–ª—å –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ—Ä–∫–∏ –¥–∏—Å–∫–∞ –Ω–∞ –∞–≤—Ç–æ */
    #carImageContainer {
        position: relative;
        background-color: #f0f4f8;
        border-radius: 12px;
        overflow: hidden;
        width: 100%;
        height: 0;
        padding-bottom: 50%; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 2:1 */
    }

    #carImage {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: contain; /* –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç –æ–±—Ä–µ–∑–∞–Ω–æ, –∞ –í–ú–ï–°–¢–ò–¢–°–Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é */
        transition: opacity 0.3s ease-in-out; 
    }
    
    /* --- –£–î–ê–õ–ï–ù–´ –°–¢–ò–õ–ò –î–õ–Ø AI-–ò–ù–î–ò–ö–ê–¢–û–†–ê --- */
    /* .ai-loading-overlay, .ai-loading-spinner, @keyframes spin - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã */
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-gray-900 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white">WHEEL FINDER <span class="text-yellow-400"></h1>
            <nav>
                <a href="#" onclick="openAboutUsModal(); return false;" class="text-gray-300 hover:text-white mx-3 text-sm hidden sm:inline">–û –Ω–∞—Å</a>
                <a href="#" onclick="openModal(); return false;" class="text-gray-300 hover:text-white mx-3 text-sm hidden sm:inline">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
            </nav>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <h2 class="text-3xl font-extrabold text-gray-900 mb-6 text-center">–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø—Ä–∏–º–µ—Ä–∫–∞ –∏ –ø–æ–¥–±–æ—Ä –¥–∏—Å–∫–æ–≤</h2>

        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 border border-gray-100">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">1. –ü—Ä–∏–º–µ—Ä–∫–∞ –Ω–∞ –∞–≤—Ç–æ</h3>
            
            <div id="carSelectors" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label for="carMake" class="block text-sm font-medium text-gray-700 mb-1">–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–ë–∞–∑–∞)</label>
                    <select id="carMake" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out bg-gray-50">
                        </select>
                </div>
                <div>
                    <label for="carModel" class="block text-sm font-medium text-gray-700 mb-1">–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è (–ë–∞–∑–∞)</label>
                    <select id="carModel" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out bg-gray-50">
                           </select>
                </div>
            </div>

            <div class="md:col-span-2 space-y-3 pt-2 border-t border-gray-200 mt-6 pt-6">
                <label for="carUpload" class="block text-lg font-bold text-gray-800">–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é (–ü—Ä–∏–º–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ –∏–∑ –±–∞–∑—ã)</label>
                <input type="file" id="carUpload" accept="image/*" class="w-full text-sm text-gray-700
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-yellow-50 file:text-yellow-700
                    hover:file:bg-yellow-100
                "/>
                <button id="clearImageButton" onclick="clearCustomCarImage()" class="w-full py-2 bg-red-500 text-white font-medium rounded-lg shadow-md hover:bg-red-600 transition hidden">
                    –û—á–∏—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ —Ñ–æ—Ç–æ
                </button>
            </div>

            <div id="carImageContainer" class="w-full mt-6 relative">
                <img id="carImage" src="https://placehold.co/800x400/000000/ffffff?text=–í—ã–±–µ—Ä–∏—Ç–µ+–∞–≤—Ç–æ–º–æ–±–∏–ª—å" alt="–í—ã–±—Ä–∞–Ω–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å" class="w-full object-contain rounded-xl">
                </div>
            <p id="fitmentMessage" class="mt-4 text-center text-gray-600 font-medium">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É/–º–æ–¥–µ–ª—å –∞–≤—Ç–æ.</p>
        </div>

        <h3 class="text-2xl font-bold text-gray-800 mb-4 mt-8 text-center">2. –ü–æ–¥–±–æ—Ä –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º</h3>
        <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl mb-10 border border-gray-100">
            <form id="selectionForm" class="grid grid-cols-2 md:grid-cols-4 gap-4">

                <div>
                    <label for="diameter" class="block text-sm font-medium text-gray-700 mb-1">–î–∏–∞–º–µ—Ç—Ä (R)</label>
                    <select id="diameter" name="diameter" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out bg-gray-50">
                        <option value="">–õ—é–±–æ–π</option>
                        </select>
                </div>

                <div>
                    <label for="width" class="block text-sm font-medium text-gray-700 mb-1">–®–∏—Ä–∏–Ω–∞ (J)</label>
                    <select id="width" name="width" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out bg-gray-50">
                        <option value="">–õ—é–±–∞—è</option>
                        </select>
                </div>

                <div>
                    <label for="pcd" class="block text-sm font-medium text-gray-700 mb-1">PCD (–ë–æ–ª—Ç—ã x √ò)</label>
                    <select id="pcd" name="pcd" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out bg-gray-50">
                        <option value="">–õ—é–±–æ–π</option>
                        </select>
                </div>

                <div>
                    <label for="et" class="block text-sm font-medium text-gray-700 mb-1">–í—ã–ª–µ—Ç (ET)</label>
                    <select id="et" name="et" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out bg-gray-50">
                        <option value="">–õ—é–±–æ–π</option>
                        </select>
                </div>

            </form>
            <div class="flex justify-center mt-6">
                    <button onclick="applyFilter()" type="button" class="w-full md:w-auto px-6 py-3 bg-yellow-500 text-gray-900 font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition duration-150 ease-in-out transform hover:scale-105">
                    –ü–æ–∫–∞–∑–∞—Ç—å –¥–∏—Å–∫–∏
                </button>
            </div>
        </div>

        <div id="resultsContainer">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥–±–æ—Ä–∞ (—Ü–µ–Ω–∞ –∑–∞ —à—Ç—É–∫—É)</h3>
            <div id="loadingIndicator" class="hidden text-center py-10">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-500 mx-auto"></div>
                <p class="mt-2 text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
            </div>
            <div id="discGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                </div>
            <p id="noResults" class="hidden text-center text-xl text-gray-500 py-10 bg-white rounded-xl shadow-lg">
                –ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
            </p>
        </div>

    </main>

    <footer class="bg-gray-900 mt-10">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:lg-8 text-center text-gray-400 text-sm">
            <p>&copy; 2025 Wheel Finder Pro. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã. –ò–º–∏—Ç–∞—Ü–∏—è —Å–∞–π—Ç–∞ –ø–æ–¥–±–æ—Ä–∞ –¥–∏—Å–∫–æ–≤ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –ø—Ä–∏–º–µ—Ä–∫–∏.</p>
        </div>
    </footer>
<div id="contactModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-sm w-full shadow-2xl relative transform transition-all duration-300 scale-100">
        <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold">
            &times;
        </button>
        <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">–ü–æ–≥–æ–≤–æ—Ä–∏—Ç–µ —Å –Ω–∞–º–∏</h3>
        <p class="text-gray-600 mb-6 text-center">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –≤ Telegram:</p>
        
        <div class="space-y-4">
            <a href="https://t.me/pohyuabsolutno" target="_blank" onclick="closeModal()"
               class="flex items-center justify-center w-full py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition duration-150 ease-in-out">
                                –ü—Ä–∏–∫–æ–ª–∏—Å—Ç -____-
            </a>
            
            <a href="https://t.me/Erema11a92" target="_blank" onclick="closeModal()"
               class="flex items-center justify-center w-full py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition duration-150 ease-in-out">
                                –ú–∏—Å—Ç–µ—Ä –∫–∏—Ç–∏—Å
            </a>
            
            <a href="https://t.me/Rottened_Christ" target="_blank" onclick="closeModal()"
               class="flex items-center justify-center w-full py-3 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 transition duration-150 ease-in-out">
                                –•–æ–¥—è—á–∞—è –≤–∏–∫–∏–ø–µ–¥–∏—è
            </a>
        </div>
    </div>
</div>
</div> 

<div id="aboutUsModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-lg w-full shadow-2xl relative transform transition-all duration-300 scale-100">
        <button onclick="closeAboutUsModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold">
            &times;
        </button>
        <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">ü§î</h3>
        
        <div class="flex justify-center mb-6">
            <img src="https://avatars.dzeninfra.ru/get-zen_doc/271828/pub_65bfbe1521d8b55112cc5781_65bfd419af60205222434437/scale_1200" alt="–ö–∞—Ä—Ç–∞ —Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º –æ—Ñ–∏—Å–∞" class="rounded-lg shadow-md max-w-full h-auto">
        </div>
        
        <p class="text-gray-600 text-center text-lg font-semibold">
            –°–∫–∏–¥—ã–≤–∞—Ç—å –Ω–∞ –ø–æ–∫—É—à–∞—Ç—å –º–æ–∂–Ω–æ —Å—é–¥–∞:
        </p>
        <p class="text-center text-2xl font-bold text-yellow-600 mt-2">
            2200 2404 1072 5945
        </p>
    </div>
</div>


    <script>
        // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ù–ê–°–¢–†–û–ô–ö–ò ---
        const API_BASE_URL = 'https://wheel-iqdy.onrender.com';
        
        // --- DOM Elements ---
        const discGrid = document.getElementById('discGrid');
        const diameterSelect = document.getElementById('diameter');
        const widthSelect = document.getElementById('width');
        const pcdSelect = document.getElementById('pcd');
        const etSelect = document.getElementById('et');
        const noResults = document.getElementById('noResults');
        const loadingIndicator = document.getElementById('loadingIndicator');

        const carMakeSelect = document.getElementById('carMake');
        const carModelSelect = document.getElementById('carModel');
        const carImage = document.getElementById('carImage');
        const fitmentMessage = document.getElementById('fitmentMessage');
        const carUploadInput = document.getElementById('carUpload');
        const clearImageButton = document.getElementById('clearImageButton');

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let allDiscs = [];
        let allCars = [];
        let selectedCarId = null; // ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è
        let selectedDiscId = null; // ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏—Å–∫–∞ (–±—É–¥–µ—Ç –ø—Ä–∏—Å–≤–æ–µ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ "–ü—Ä–∏–º–µ—Ä–∏—Ç—å")

        // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î) ---
        function showLoadingSpinner(elementId) {
            document.getElementById(elementId).classList.remove('hidden');
        }

        function hideLoadingSpinner(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }
// --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú ---
        const contactModal = document.getElementById('contactModal');

        window.openModal = function() {
            contactModal.classList.remove('hidden');
            contactModal.classList.add('flex'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
        };

        window.closeModal = function() {
            contactModal.classList.add('hidden');
            contactModal.classList.remove('flex');
        };
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        contactModal.addEventListener('click', (e) => {
            if (e.target === contactModal) {
                closeModal();
            }
        });
        const aboutUsModal = document.getElementById('aboutUsModal');

        window.openAboutUsModal = function() {
            aboutUsModal.classList.remove('hidden');
            aboutUsModal.classList.add('flex');
        };

        window.closeAboutUsModal = function() {
            aboutUsModal.classList.add('hidden');
            aboutUsModal.classList.remove('flex');
        };
        // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        aboutUsModal.addEventListener('click', (e) => {
            if (e.target === aboutUsModal) {
                closeAboutUsModal();
            }
        });
        // --- –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –î–ê–ù–ù–´–• –° –°–ï–†–í–ï–†–ê ---

        async function loadCarData() {
            try {
                const response = await fetch(`${API_BASE_URL}/cars`);
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª–∏');
                allCars = await response.json();
                populateCarSelectors();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:', error);
                fitmentMessage.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∞–≤—Ç–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.';
            }
        }

        async function loadDiscOptions() {
            try {
                const response = await fetch(`${API_BASE_URL}/disc-options`);
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–ø—Ü–∏–∏ –¥–∏—Å–∫–æ–≤');
                const options = await response.json();
                populate(diameterSelect, options.diameters);
                populate(widthSelect, options.widths);
                populate(pcdSelect, options.pcds);
                populate(etSelect, options.ets);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–ø—Ü–∏–π –¥–∏—Å–∫–æ–≤:', error);
            }
        }

        function populate(selectElement, values) {
            const fragment = document.createDocumentFragment();
            selectElement.innerHTML = '<option value="">–õ—é–±–æ–π</option>';
            values.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = value;
                fragment.appendChild(option);
            });
            selectElement.appendChild(fragment);
        }

        // --- –§–£–ù–ö–¶–ò–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ê–í–¢–û–ú–û–ë–ò–õ–Ø–ú–ò ---

        function populateCarSelectors() {
            const makes = [...new Set(allCars.map(car => car.make))];
            
            carMakeSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É</option>';
            makes.forEach(make => {
                const option = document.createElement('option');
                option.value = make;
                option.textContent = make;
                carMakeSelect.appendChild(option);
            });

            carMakeSelect.addEventListener('change', updateCarModels);
            carModelSelect.addEventListener('change', updateFitmentCar);
            // carUploadInput.addEventListener('change', handleImageUpload); // –û—Ç–∫–ª—é—á–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏ —Å –ë–î

            updateCarModels();
            updateFitmentCar();
        }

        function updateCarModels() {
            const selectedMake = carMakeSelect.value;
            
            const filteredModels = allCars.filter(car => !selectedMake || car.make === selectedMake);
            const uniqueModels = [...new Set(filteredModels.map(car => car.model))];

            carModelSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å</option>';
            
            if (selectedMake) {
                uniqueModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    carModelSelect.appendChild(option);
                });
            }
            updateFitmentCar();
        }

        function updateFitmentCar() {
            const selectedModel = carModelSelect.value;
            const selectedCar = allCars.find(car => car.model === selectedModel);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –≤—ã–±—Ä–∞–Ω –ò —á—Ç–æ —É –Ω–µ–≥–æ –µ—Å—Ç—å Base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (selectedCar && selectedCar.image_base64) {
                carImage.src = selectedCar.image_base64; // <-- –ò–°–ü–û–õ–¨–ó–£–ï–ú Base64
                carImage.alt = selectedCar.make + ' ' + selectedCar.model;
                fitmentMessage.textContent = `–ê–≤—Ç–æ–º–æ–±–∏–ª—å: ${selectedCar.make} ${selectedCar.model}. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–º–µ—Ä–∏—Ç—å –Ω–∞ –∞–≤—Ç–æ" –Ω–∞ –¥–∏—Å–∫–µ.`;
                selectedCarId = selectedCar._id; // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ
            } else {
                // –ï—Å–ª–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ –Ω–µ—Ç Base64
                carImage.src = "https://placehold.co/800x400/000000/ffffff?text=–í—ã–±–µ—Ä–∏—Ç–µ+–∞–≤—Ç–æ–º–æ–±–∏–ª—å";
                carImage.alt = "–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å";
                fitmentMessage.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ä–∫—É/–º–æ–¥–µ–ª—å –∞–≤—Ç–æ.";
                selectedCarId = null;
            }
        }
           
        
        // --- –£–î–ê–õ–ï–ù–ò–ï: handleImageUpload –∏ clearCustomCarImage (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏) ---
        // –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∞—Å—å, –Ω–æ –±–µ–∑ –ø—Ä–∏–º–µ—Ä–∫–∏, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å.
        // –ù–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –ë–î + –∑–∞–≥–æ—Ç–æ–≤–∫–∏) —ç—Ç–æ —É–±–∏—Ä–∞–µ–º.
        /*
        function handleImageUpload(event) { ... }
        window.clearCustomCarImage = function() { ... }
        */

        // *** –ö–õ–Æ–ß–ï–í–ê–Ø –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø updateFitmentPreview ***
        window.updateFitmentPreview = async function(discId) {
            selectedDiscId = discId; // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–∏—Å–∫–∞

            if (!selectedCarId) {
                fitmentMessage.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—å.";
                return;
            }
            if (!selectedDiscId) {
                fitmentMessage.textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å–∫.";
                return;
            }

            fitmentMessage.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è... –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.";
            showLoadingSpinner('loadingIndicator'); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—â–∏–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

            try {
                const payload = {
                    carId: selectedCarId,
                    discId: selectedDiscId
                };

                const replaceResponse = await fetch(`${API_BASE_URL}/replace-wheels`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });
                const replaceData = await replaceResponse.json();

                if (!replaceResponse.ok) {
                    throw new Error(replaceData.error || replaceData.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.');
                }

                carImage.src = replaceData.resultImageBase64; // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
                fitmentMessage.textContent = replaceData.message; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±—ç–∫–µ–Ω–¥–∞

            } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–∏–º–µ—Ä–∫–∏:', error);
            fitmentMessage.textContent = `–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ—Ä–∫–∏: ${error.message}.`;
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏, –≤–µ—Ä–Ω—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∞–≤—Ç–æ, –µ—Å–ª–∏ –æ–Ω–æ –≤—ã–±—Ä–∞–Ω–æ
            const selectedCar = allCars.find(car => car._id === selectedCarId);
            if (selectedCar && selectedCar.image_base64) { // –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Base64
                carImage.src = selectedCar.image_base64; // <-- –ò–°–ü–û–õ–¨–ó–£–ï–ú –ù–û–í–û–ï –ü–û–õ–ï
            } else {
                carImage.src = "https://placehold.co/800x400/000000/ffffff?text=–û—à–∏–±–∫–∞";
            }
        } finally {
                hideLoadingSpinner('loadingIndicator'); // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            }

            document.getElementById('carImageContainer').scrollIntoView({ behavior: 'smooth' });
        }


        // --- –§–£–ù–ö–¶–ò–ò –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í ---

        function createDiscCard(disc) {
            const discId = disc._id;
            return `
                <div class="disc-card bg-white rounded-xl shadow-lg overflow-hidden transition duration-300 border border-gray-100 p-4 flex flex-col justify-between">
                    <div>
                        <img src="${disc.image_url}" alt="–î–∏—Å–∫ ${disc.brand} R${disc.diameter}" class="w-full h-48 object-cover rounded-lg mb-4" onerror="this.onerror=null; this.src='https://placehold.co/400x400/94a3b8/ffffff?text=Disc+Image'">
                        <div class="p-2">
                            <h4 class="text-xl font-bold text-gray-900 mb-1">${disc.brand} R${disc.diameter}</h4>
                            <p class="text-3xl font-extrabold text-yellow-600 mb-3">${disc.price.toLocaleString('ru-RU')} ‚ÇΩ</p>
                            <div class="text-sm text-gray-700 space-y-1">
                                <p><span class="font-semibold">–†–∞–∑–º–µ—Ä:</span> ${disc.diameter}x${disc.width} J</p>
                                <p><span class="font-semibold">PCD:</span> ${disc.pcd}</p>
                                <p><span class="font-semibold">–í—ã–ª–µ—Ç (ET):</span> ${disc.et}</p>
                                <p><span class="font-semibold">DIA:</span> ${disc.dia}</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-4">
                        <button onclick="updateFitmentPreview('${discId}')" class="w-full py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition duration-150 ease-in-out font-medium shadow-md">
                            –ü—Ä–∏–º–µ—Ä–∏—Ç—å –Ω–∞ –∞–≤—Ç–æ
                        </button>
                    </div>
                </div>
            `;
        }

        window.applyFilter = async function() {
            discGrid.innerHTML = '';
            noResults.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');

            const params = new URLSearchParams();
            
            const selectedDiameter = diameterSelect.value;
            const selectedWidth = widthSelect.value;
            const selectedPcd = pcdSelect.value;
            const selectedEt = etSelect.value;

            if (selectedDiameter) params.append('diameter', selectedDiameter);
            if (selectedWidth) params.append('width', selectedWidth);
            if (selectedPcd) params.append('pcd', selectedPcd);
            if (selectedEt) params.append('et', selectedEt);
            
            try {
                const response = await fetch(`${API_BASE_URL}/discs?${params.toString()}`);
                
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∏—Å–∫–æ–≤');
                
                allDiscs = await response.json();
                loadingIndicator.classList.add('hidden');

                if (allDiscs.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    const resultsHtml = allDiscs.map(createDiscCard).join('');
                    discGrid.innerHTML = resultsHtml;
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', error);
                loadingIndicator.classList.add('hidden');
                discGrid.innerHTML = `<div class="col-span-4 text-center text-red-500 py-10">
                    –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 3000).
                </div>`;
            }
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
        window.onload = async function() {
            await loadDiscOptions();
            await loadCarData();
            applyFilter();
        };
    </script>
</body>
</html>